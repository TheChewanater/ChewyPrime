package chewyprime.rpg;

import java.io.Console;
import java.io.File;
import java.io.IOException;
import java.lang.Integer;
import java.util.HashMap;

import com.jme3.export.xml.*;

import chewyprime.rpg.actions.*;

public class RPGMain
{
  Character mTux, mEnemy;
  
  public RPGMain()
  {
    XMLImporter mImporter = new XMLImporter();
    XMLExporter mExporter = new XMLExporter();
    
    HashMap<String, Action> mActions = new HashMap<String, Action>();
    
    Console mConsole = System.console();
    
    try
      {
        mTux = (Character)mImporter.load(new File("tux.character"));
        mEnemy = (Character)mImporter.load(new File("enemy.character"));
      }
    catch(IOException e)
      {
        System.err.println(e);
        return;
      }
    
    addAction(new MeleeAttackAction());
    addAction(new RangedAttackAction());
    
    while(true)
      {
        System.out.println(mTux);
        System.out.println(mEnemy);
        System.out.println("");
        
        String name = mConsole.readLine();
        Action action = mActions.get(name);
        
        while((action == null) || !action.canAct(mTux, mEnemy))
          {
            if(action == null)
              System.out.println("(!) Invalid action '" + name + "'");
            else
              System.out.println("(!) Cannot use '" + name + "'");
            
            name = mConsole.readLine();
            action = mActions.get(name);
          }
        
        int result = action.act(mTux, mEnemy);
        System.out.println("(!) RESULT: " + result);
        System.out.println("");
      }
  }
  
  private void addAction(Action action)
  {
    mActions.put(action.getName(), action);
  }
  
  public static void main(String[] args)
  {
    new RPGMain();
  }
}

